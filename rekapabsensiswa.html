<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Harian & Rekapitulasi - SMPN 8 Cikarang Utara</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/mRmw86t.jpeg">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9; /* Soft light background */
        }
        .container {
            max-width: 1400px;
        }
        /* Custom scrollbar style for better visibility */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Modern shadow */
        }
        .table-wrapper::-webkit-scrollbar {
            height: 10px;
        }
        .table-wrapper::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 10px;
        }
        .table-wrapper::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
        }
        /* Sticky columns configuration for Absensi Harian */
        .sticky-col-name {
            min-width: 180px; /* Lebih lebar untuk nama */
            max-width: 180px;
            width: 180px;
            left: 0;
            z-index: 10;
        }
        .sticky-col-class {
            min-width: 90px;
            max-width: 90px;
            width: 90px;
            left: 180px; /* Lebar Nama (180px) */
            z-index: 10;
        }
        /* Style for active and inactive tabs */
        .tab-button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            border-radius: 0.75rem 0.75rem 0 0;
            transition: all 0.3s ease;
            margin-right: 0.25rem;
        }
        .tab-active {
            color: #1e40af; /* blue-700 */
            background-color: #ffffff;
            border-top: 3px solid #3b82f6; /* blue-500 */
            border-left: 1px solid #e5e7eb;
            border-right: 1px solid #e5e7eb;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }
        .tab-inactive {
            color: #6b7280; /* gray-500 */
            background-color: #e2e8f0; /* gray-200 */
            border-bottom: 3px solid transparent;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header Dinamis dengan Logo dan Tombol Beranda -->
        <header class="bg-white p-6 md:p-8 rounded-2xl shadow-xl mb-8 flex flex-col md:flex-row items-start md:items-center justify-between">
            
            <!-- Logo dan Judul -->
            <div class="flex items-center mb-4 md:mb-0">
                <img src="https://i.imgur.com/mRmw86t.jpeg" 
                     onerror="this.onerror=null; this.src='https://placehold.co/80x80/2563EB/FFFFFF?text=Logo';" 
                     alt="Logo Sekolah" 
                     class="w-16 h-16 object-cover rounded-full shadow-md mr-4">
                <div>
                    <h1 class="text-2xl md:text-3xl font-extrabold text-blue-800 tracking-tight">
                        Papan Absensi Siswa
                    </h1>
                    <p class="text-sm text-gray-500">
                        SMP Negeri 8 Cikarang Utara
                    </p>
                </div>
            </div>

            <!-- Tombol Kembali ke Beranda -->
            <a href="Halamanguru.html" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-full shadow-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-[1.02]">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                Kembali ke Halaman Guru
            </a>
        </header>
        
        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-300 mb-6">
            <button id="tab-harian" class="tab-button tab-active">Absensi Harian</button>
            <button id="tab-rekap" class="tab-button tab-inactive">Rekap Absen</button>
        </div>
        
        <!-- Tab 1: Absensi Harian Content -->
        <div id="absensi-harian-content">
            <!-- Control Panel and Filters (Harian) -->
            <div class="bg-white p-5 rounded-xl shadow-lg mb-6 flex flex-col md:flex-row gap-4 items-stretch md:items-center">
                
                <!-- Filter Kelas (Harian) -->
                <div class="w-full md:w-auto">
                    <label for="kelas-filter" class="block text-xs font-medium text-gray-600 mb-1">Filter Kelas:</label>
                    <select id="kelas-filter" class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50 appearance-none cursor-pointer focus:ring-2 focus:ring-blue-500 transition">
                        <option value="">Semua Kelas</option>
                    </select>
                </div>
                
                <!-- Pencarian Nama (Harian) -->
                <div class="w-full md:flex-grow">
                    <label for="search-input" class="block text-xs font-medium text-gray-600 mb-1">Cari Nama Siswa:</label>
                    <input type="text" id="search-input" placeholder="Ketik nama siswa..." 
                           class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                </div>
            </div>
            
            <!-- Loading & Error Messages -->
            <div id="loading-message" class="text-center p-6 bg-yellow-100 text-yellow-800 rounded-xl shadow-lg hidden">
                <div class="flex items-center justify-center space-x-2">
                    <svg class="animate-spin h-5 w-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>Memuat data dari Google Sheets...</span>
                </div>
            </div>
            <div id="error-message" class="text-left p-6 bg-red-100 text-red-800 rounded-xl shadow-lg hidden">
                <h3 class="font-bold text-lg mb-2">⚠️ Gagal Memuat Data (Error 404)</h3>
                <p>Terjadi kesalahan HTTP 404. Ini berarti **URL CSV Google Sheet Anda tidak ditemukan atau tidak valid.**</p>
                <p class="mt-2">**Solusi:**</p>
                <ol class="list-decimal list-inside ml-4 text-sm">
                    <li>Buka Google Sheet Absensi Anda.</li>
                    <li>Pilih **File > Bagikan > Publikasikan ke web** (File > Share > Publish to the web).</li>
                    <li>Di tab "Link", pilih **CSV** (bukan Web Page) untuk dokumen secara keseluruhan.</li>
                    <li>Salin URL yang diberikan dan **GANTI** nilai `GOOGLE_SHEET_CSV_URL` di dalam kode.</li>
                </ol>
                <p class="mt-2 font-medium">Data tidak dapat ditampilkan sebelum URL diperbaiki.</p>
            </div>
            <div id="no-data-message" class="text-center p-6 bg-gray-100 text-gray-600 rounded-xl shadow-lg hidden">
                Tidak ada data yang sesuai dengan filter.
            </div>

            <!-- Data Table Container (Harian) -->
            <div class="table-wrapper">
                <table id="data-table" class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <!-- Headers will be generated here -->
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-100">
                        <!-- Data rows will be generated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Rekap Absen Content -->
        <div id="rekap-absen-content" class="hidden">
            <!-- Control Panel and Filters (Rekap) -->
            <div class="bg-white p-5 rounded-xl shadow-lg mb-6 flex flex-col md:flex-row gap-4 items-stretch md:items-center">
                
                <!-- Filter Kelas (Rekap) -->
                <div class="w-full md:w-auto">
                    <label for="rekap-kelas-filter" class="block text-xs font-medium text-gray-600 mb-1">Filter Kelas (Rekap):</label>
                    <select id="rekap-kelas-filter" class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50 appearance-none cursor-pointer focus:ring-2 focus:ring-blue-500 transition">
                        <option value="">Semua Kelas</option>
                    </select>
                </div>
                
                <!-- Pencarian Nama (Rekap) -->
                <div class="w-full md:flex-grow">
                    <label for="rekap-search-input" class="block text-xs font-medium text-gray-600 mb-1">Cari Nama Siswa (Rekap):</label>
                    <input type="text" id="rekap-search-input" placeholder="Ketik nama siswa..." 
                           class="w-full p-2 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 transition">
                </div>
            </div>

            <div id="rekap-no-data-message" class="text-center p-6 bg-gray-100 text-gray-600 rounded-xl shadow-lg hidden">
                Tidak ada data rekapitulasi yang sesuai dengan filter.
            </div>

            <!-- Data Table Container (Rekap) -->
            <div class="table-wrapper">
                <table id="rekap-table" class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <!-- Headers will be generated here -->
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-100">
                        <!-- Data rows will be generated here -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script type="module">
        // --- KONFIGURASI PENTING ---
        // GANTI URL INI DENGAN LINK EKSPOR CSV PUBLIK GOOGLE SHEET ANDA!
        // PASTIKAN ANDA SUDAH: File > Bagikan > Publikasikan ke web > Pilih CSV.
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRm3OEXqf5PTCq1QjeC5C5budexAIzIXIZTMFErRijyT_zMCnzbNAQpl1nQjj_WGs0UT5Dqcg54LL7t/pub?gid=1932857207&single=true&output=csv"; // CONTOH URL. HARUS DIGANTI!
        
        // Indeks Baris CSV (0-based)
        const DATE_ROW_INDEX = 2; // Baris ke-3 CSV (sesuai C3, D3, ...)
        const DATA_START_ROW_INDEX = 4; // Baris ke-5 CSV (sesuai A5, B5, ...)
        const NAME_COL_INDEX = 0; // Kolom A
        const CLASS_COL_INDEX = 1; // Kolom B
        const DATE_COL_START_INDEX = 2; // Kolom C (tempat tanggal dimulai)

        // --- AKHIR KONFIGURASI ---

        let allStudentData = [];
        let dateHeaders = [];
        let recapStudentData = []; // Data yang sudah direkap (dihitung)

        // UI Elements - Harian Tab
        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');
        const noDataMessage = document.getElementById('no-data-message');
        const searchInput = document.getElementById('search-input');
        const kelasFilter = document.getElementById('kelas-filter');
        const dataTable = document.getElementById('data-table');
        const tableBody = dataTable.querySelector('tbody');
        const tableHead = dataTable.querySelector('thead');
        
        // UI Elements - Rekap Tab
        const rekapTable = document.getElementById('rekap-table');
        const rekapTableHead = rekapTable.querySelector('thead');
        const rekapTableBody = rekapTable.querySelector('tbody');
        const rekapSearchInput = document.getElementById('rekap-search-input');
        const rekapKelasFilter = document.getElementById('rekap-kelas-filter');
        const rekapNoDataMessage = document.getElementById('rekap-no-data-message');

        // Tab Navigation Elements
        const tabHarian = document.getElementById('tab-harian');
        const tabRekap = document.getElementById('tab-rekap');
        const contentHarian = document.getElementById('absensi-harian-content');
        const contentRekap = document.getElementById('rekap-absen-content');

        // Helper untuk memecah baris CSV menjadi array nilai
        function splitCSVRow(line) {
             // Membagi berdasarkan koma, mengabaikan koma di dalam tanda kutip (untuk robustness)
            return line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ''));
        }

        // Parse CSV khusus untuk layout Absensi Harian
        function parseAttendanceCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < DATA_START_ROW_INDEX + 1) return { studentData: [], dates: [] };

            // 1. Ambil Baris Header Tanggal
            const dateRowValues = splitCSVRow(lines[DATE_ROW_INDEX]);
            
            const dates = dateRowValues.slice(DATE_COL_START_INDEX).filter(d => d.trim() !== '');
            dateHeaders = dates;

            // 2. Ambil Data Siswa
            const rawDataRows = lines.slice(DATA_START_ROW_INDEX);
            const studentData = [];
            const uniqueKelas = new Set();

            rawDataRows.forEach(line => {
                const values = splitCSVRow(line);
                const name = values[NAME_COL_INDEX] || '';
                const studentClass = values[CLASS_COL_INDEX] || '';

                if (name) {
                    const studentRecord = {
                        name: name,
                        class: studentClass,
                        attendance: {} 
                    };
                    
                    if(studentClass) uniqueKelas.add(studentClass);

                    // Ambil status kehadiran untuk setiap tanggal
                    dates.forEach((dateHeader, i) => {
                        const colIndex = DATE_COL_START_INDEX + i;
                        const status = values[colIndex] || '';
                        studentRecord.attendance[dateHeader] = status;
                    });
                    
                    studentData.push(studentRecord);
                }
            });
            
            // Isi filter kelas untuk kedua tab
            kelasFilter.innerHTML = '<option value="">Semua Kelas</option>';
            rekapKelasFilter.innerHTML = '<option value="">Semua Kelas</option>';
            
            Array.from(uniqueKelas).sort().forEach(kelas => {
                kelasFilter.innerHTML += `<option value="${kelas}">${kelas}</option>`;
                rekapKelasFilter.innerHTML += `<option value="${kelas}">${kelas}</option>`;
            });

            return studentData;
        }


        // Fetch data dari URL tunggal
        async function fetchData() {
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            noDataMessage.classList.add('hidden');
            allStudentData = [];
            dateHeaders = [];
            recapStudentData = []; // Reset rekap data

            try {
                const response = await fetch(GOOGLE_SHEET_CSV_URL);
                if (!response.ok) {
                    // Tangani error HTTP seperti 404
                    if (response.status === 404) {
                       throw new Error(`HTTP error! status: 404. URL CSV mungkin salah atau belum dipublikasikan.`);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                allStudentData = parseAttendanceCSV(csvText);
                
                // Setelah data dimuat, rekap data langsung dihitung
                recapStudentData = calculateRecapData(allStudentData);
                
                // Hanya render Harian jika tab Harian aktif
                if (tabHarian.classList.contains('tab-active')) {
                    applyFilters();
                }

            } catch (error) {
                console.error("Error fetching or parsing data:", error);
                
                // Tampilkan pesan error kepada pengguna
                errorMessage.classList.remove('hidden');
                
            } finally {
                loadingMessage.classList.add('hidden');
            }
        }
        
        // --- LOGIKA REKAPITULASI ---

        function calculateRecapData(students) {
            return students.map(student => {
                let masuk = 0; // Masuk/Hadir
                let sakit = 0; // Sakit
                let izin = 0; // Izin
                let alfa = 0; // Alfa

                Object.values(student.attendance).forEach(status => {
                    // Ambil karakter pertama dari status (di-trim dan di-lowercase)
                    const firstChar = status.trim().toLowerCase().charAt(0);
                    
                    switch (firstChar) {
                        case 'm': // Masuk
                        case 'h': // Hadir
                            masuk++;
                            break;
                        case 's': // Sakit
                            sakit++;
                            break;
                        case 'i': // Izin
                            izin++;
                            break;
                        case 'a': // Alfa
                            alfa++;
                            break;
                    }
                });

                return {
                    name: student.name,
                    class: student.class,
                    masuk,
                    sakit,
                    izin,
                    alfa,
                    totalDays: Object.keys(student.attendance).length
                };
            });
        }
        
        function applyRecapFilters() {
            const searchTerm = rekapSearchInput.value.toLowerCase();
            const selectedKelas = rekapKelasFilter.value;

            const filteredData = recapStudentData.filter(student => {
                const nameMatch = student.name.toLowerCase().includes(searchTerm);
                const classMatch = selectedKelas ? student.class === selectedKelas : true;
                return nameMatch && classMatch;
            });

            renderRecapTable(filteredData);
        }

        function renderRecapTable(data) {
            rekapTableHead.innerHTML = '';
            rekapTableBody.innerHTML = '';
            rekapNoDataMessage.classList.add('hidden');

            if (data.length === 0 && allStudentData.length > 0) {
                rekapNoDataMessage.classList.remove('hidden');
                return;
            } else if (data.length === 0 && allStudentData.length === 0 && !errorMessage.classList.contains('hidden')) {
                // Jangan tampilkan pesan "Tidak ada data" jika error utama sedang ditampilkan
                return;
            }

            // 1. Render Header
            rekapTableHead.innerHTML = `
                <tr class="bg-blue-600 text-white sticky top-0 z-10 rounded-t-xl">
                    <th class="px-4 py-3 text-left text-sm font-semibold rounded-tl-xl">Nama Siswa</th>
                    <th class="px-4 py-3 text-left text-sm font-semibold">Kelas</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold bg-green-600">Masuk / Hadir (M/H)</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold bg-orange-600">Sakit (S)</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold bg-yellow-600">Izin (I)</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold bg-red-600">Alfa (A)</th>
                    <th class="px-4 py-3 text-center text-sm font-semibold bg-gray-600 rounded-tr-xl">Total Hari Absensi</th>
                </tr>
            `;

            // 2. Render Body
            data.forEach((record, index) => {
                const isEven = index % 2 === 0;
                let rowHtml = `<tr class="${isEven ? 'bg-gray-50' : 'bg-white'} hover:bg-blue-50 transition duration-150">`;

                rowHtml += `<td class="px-4 py-3 whitespace-nowrap text-sm font-semibold text-gray-900">${record.name}</td>`;
                rowHtml += `<td class="px-4 py-3 whitespace-nowrap text-xs font-medium text-gray-600">${record.class}</td>`;
                
                // Masuk/Hadir
                rowHtml += `<td class="px-4 py-3 text-center text-sm font-bold text-green-700">${record.masuk}</td>`;
                // Sakit
                rowHtml += `<td class="px-4 py-3 text-center text-sm font-bold text-orange-700">${record.sakit}</td>`;
                // Izin
                rowHtml += `<td class="px-4 py-3 text-center text-sm font-bold text-yellow-700">${record.izin}</td>`;
                // Alfa
                rowHtml += `<td class="px-4 py-3 text-center text-sm font-bold text-red-700">${record.alfa}</td>`;
                // Total Days
                rowHtml += `<td class="px-4 py-3 text-center text-sm font-medium text-gray-500">${record.totalDays}</td>`;

                rowHtml += '</tr>';
                rekapTableBody.innerHTML += rowHtml;
            });
        }

        // --- LOGIKA ABSENSI HARIAN (Filter dan Render) ---

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedKelas = kelasFilter.value;

            const filteredData = allStudentData.filter(student => {
                const nameMatch = student.name.toLowerCase().includes(searchTerm);
                const classMatch = selectedKelas ? student.class === selectedKelas : true;
                return nameMatch && classMatch;
            });

            renderTable(filteredData);
        }

        function renderTable(data) {
            tableHead.innerHTML = '';
            tableBody.innerHTML = '';
            noDataMessage.classList.add('hidden');

             if (data.length === 0 && allStudentData.length > 0) {
                 noDataMessage.classList.remove('hidden');
                 return;
            } else if (data.length === 0 && allStudentData.length === 0 && !errorMessage.classList.contains('hidden')) {
                // Jangan tampilkan pesan "Tidak ada data" jika error utama sedang ditampilkan
                return;
            }

            // 1. Render Header (Absensi Harian)
            let headerHtml = `
                <tr class="bg-blue-600 text-white sticky top-0 z-20">
                    <th class="sticky left-0 bg-blue-600 px-4 py-3 text-left text-sm font-semibold whitespace-nowrap sticky-col-name rounded-tl-xl" rowspan="2">Nama Siswa</th>
                    <th class="sticky bg-blue-600 px-4 py-3 text-left text-sm font-semibold whitespace-nowrap sticky-col-class" rowspan="2">Kelas</th>
                    <th colspan="${dateHeaders.length}" class="px-4 py-1 text-center text-sm font-semibold border-b border-blue-400">Absensi Harian (Tanggal)</th>
                </tr>
                <tr class="bg-blue-500 text-white sticky top-12 z-20 border-t border-blue-400">
            `;
            
            // Header Tanggal
            dateHeaders.forEach(date => {
                const displayDate = date.split('/')[0] 
                headerHtml += `<th class="px-2 py-2 text-center text-xs font-medium whitespace-nowrap">${displayDate}</th>`;
            });
            headerHtml += '</tr>';
            tableHead.innerHTML = headerHtml;

            // 2. Render Body
            data.forEach((student, index) => {
                const isEven = index % 2 === 0;
                let rowHtml = `<tr class="${isEven ? 'bg-gray-50' : 'bg-white'} hover:bg-blue-50 transition duration-150">`;

                // Kolom Nama (Sticky Left 0)
                rowHtml += `<td class="sticky left-0 bg-white/90 backdrop-blur-[1px] z-10 px-4 py-3 whitespace-nowrap text-sm font-semibold text-gray-900 sticky-col-name border-r border-gray-200">${student.name}</td>`;
                
                // Kolom Kelas (Sticky Left 180px)
                rowHtml += `<td class="sticky bg-white/90 backdrop-blur-[1px] z-10 px-4 py-3 whitespace-nowrap text-xs font-medium text-gray-600 sticky-col-class border-r border-gray-200">${student.class}</td>`;

                // Kolom Status Harian
                dateHeaders.forEach(date => {
                    const status = student.attendance[date] || '-';
                    const statusClass = getStatusColorClass(status);

                    rowHtml += `<td class="px-2 py-3 text-center whitespace-nowrap text-xs font-bold ${statusClass}">
                                    ${status.charAt(0).toUpperCase()}
                                </td>`;
                });

                rowHtml += '</tr>';
                tableBody.innerHTML += rowHtml;
            });
        }

        // Helper function to get Tailwind CSS class based on attendance status
        function getStatusColorClass(status) {
            switch (status.toLowerCase().charAt(0)) {
                case 'm': // Masuk
                case 'h': // Hadir
                    return 'text-green-700 font-extrabold';
                case 'i': // Izin
                    return 'text-yellow-700';
                case 's': // Sakit
                    return 'text-orange-700';
                case 'a': // Alfa
                case 't': // Terlambat
                    return 'text-red-700 font-bold';
                default:
                    return 'text-gray-400';
            }
        }
        
        // --- Tab Management ---
        function showTab(tabName) {
            if (tabName === 'harian') {
                tabHarian.classList.add('tab-active');
                tabHarian.classList.remove('tab-inactive');
                tabRekap.classList.add('tab-inactive');
                tabRekap.classList.remove('tab-active');
                contentHarian.classList.remove('hidden');
                contentRekap.classList.add('hidden');
                
                applyFilters();
            } else if (tabName === 'rekap') {
                tabRekap.classList.add('tab-active');
                tabRekap.classList.remove('tab-inactive');
                tabHarian.classList.add('tab-inactive');
                tabHarian.classList.remove('tab-active');
                contentRekap.classList.remove('hidden');
                contentHarian.classList.add('hidden');
                
                applyRecapFilters();
            }
        }

        // --- Event Listeners ---
        tabHarian.addEventListener('click', () => showTab('harian'));
        tabRekap.addEventListener('click', () => showTab('rekap'));
        
        // Harian Filters
        searchInput.addEventListener('keyup', applyFilters);
        kelasFilter.addEventListener('change', applyFilters);

        // Rekap Filters
        rekapSearchInput.addEventListener('keyup', applyRecapFilters);
        rekapKelasFilter.addEventListener('change', applyRecapFilters);

        // --- Initialize ---
        window.onload = () => {
             // Pastikan tab harian aktif saat load dan ambil data
             showTab('harian'); 
             fetchData();
        }
    </script>
</body>

</html>

